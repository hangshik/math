<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì†Œì¸ìˆ˜ë¶„í•´</title>
<script>
  window.MathJax = { tex: { inlineMath: [['$', '$']] } };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
<style>
  body { 
    font-family: 'Pretendard', sans-serif; 
    text-align: center; 
    text-size-adjust: 100%;
    background-color: #f9f9f9;
  }
  .container { 
    max-width: 600px; 
    margin: 0 auto; 
    background: white;
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  .button {
    width: 60px; height: 60px; font-size: 24px; margin: 5px;
    border-radius: 10px; border: none; background-color: #DDDDDD; cursor: pointer;
    transition: background 0.2s;
    outline: none; 
  }
  .button:hover { background-color: #bbb; }
  .button:active { background-color: #999; }
  
  .control-btn { background-color: #3399FF; color: white; width: 100px; font-size: 18px; }
  .clear-btn { background-color: #ff9800; color: white; } 
  
  #inputDisplay {
    font-size: 30px; width: 300px; height: 50px; text-align: center;
    margin: 20px 0; border: 2px solid #333; border-radius: 5px;
    background-color: #fff; cursor: text;
  }
  #problem { font-size: 50px; margin: 20px 0; font-weight: bold; color: #333; }
  
  /* ì •ë‹µ í™•ì¸ ìŠ¤íƒ€ì¼ */
  #result1, #result2, #result3 {
    font-size: 24px;
    margin: 8px 0;
    padding: 5px;
    border-radius: 5px;
  }
  
  /* í‚¤ë³´ë“œ ì•ˆë‚´ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
  .help-box {
    margin-top: 20px;
    padding: 15px;
    background-color: #eee;
    border-radius: 10px;
    font-size: 16px;
    color: #555;
    text-align: left;
    display: inline-block;
    width: 90%;
  }
  .key-tag {
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 2px 6px;
    font-weight: bold;
    font-family: monospace;
    font-size: 14px;
    color: #333;
  }
</style>
</head>
<body>
<div class="container">
  <h1>ì†Œì¸ìˆ˜ë¶„í•´</h1>
  <p style="font-size: 14px; color: #666;">ì‘ì€ ì†Œìˆ˜ë¶€í„° ê±°ë“­ì œê³± ê¼´ë¡œ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 2^3)</p>
  
  <!-- ë‹¨ê³„ ì„ íƒ -->
  <div>
    <button class="button control-btn" onclick="setStage(1)">1ë‹¨ê³„</button>
    <button class="button control-btn" onclick="setStage(2)">2ë‹¨ê³„</button>
    <button class="button control-btn" onclick="setStage(3)">3ë‹¨ê³„</button>
  </div>

  <div id="problem">Loading...</div>
  
  <div>
    <input type="text" id="inputDisplay" readonly placeholder="ì˜ˆ: 2^3 * 3">
  </div>

  <!-- í‚¤íŒ¨ë“œ -->
  <div>
    <button class="button" onclick="addChar('2')">2</button>
    <button class="button" onclick="addChar('3')">3</button>
    <button class="button" onclick="addChar('5')">5</button>
    <button class="button" onclick="addChar('7')">7</button><br>
    
    <button class="button" onclick="addChar('^')">^</button>
    <button class="button" onclick="addChar('*')">Ã—</button>
    <button class="button" onclick="backspace()">â†</button>
    <button class="button clear-btn" onclick="clearInput()">C</button><br>
    
    <button class="button control-btn" style="width: 280px; margin-top: 10px;" onclick="checkAnswer()">ì •ë‹µ í™•ì¸ (Enter)</button>
  </div>
  
  <hr style="margin: 20px 0; border: 0; border-top: 1px solid #ddd;"/>

  <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
  <div id="result1">ì •ë‹µì—¬ë¶€</div>
  <div id="result2">0ë²ˆ ì •ë‹µì…ë‹ˆë‹¤.</div>
  <div id="result3">0ë²ˆ í‹€ë ¸ìŠµë‹ˆë‹¤.</div>
  
  <!-- í‚¤ë³´ë“œ ì‚¬ìš©ë²• ì•ˆë‚´ -->
  <div class="help-box">
    <strong>âŒ¨ï¸ í‚¤ë³´ë“œ ì‚¬ìš©ë²•</strong>
    <ul style="margin: 5px 0 0 20px; padding: 0;">
      <li>ìˆ«ì ì…ë ¥: <span class="key-tag">0</span> ~ <span class="key-tag">9</span></li>
      <li>ê±°ë“­ì œê³±(^): <span class="key-tag">^</span></li>
      <li>ê³±í•˜ê¸°(Ã—): <span class="key-tag">*</span> ë˜ëŠ” <span class="key-tag">x</span></li>
      <li>ì§€ìš°ê¸°: <span class="key-tag">Backspace</span></li>
      <li>ì „ì²´ ì‚­ì œ(C): <span class="key-tag">Esc</span> ë˜ëŠ” <span class="key-tag">c</span></li>
      <li>ì •ë‹µ í™•ì¸: <span class="key-tag">Enter</span></li>
    </ul>
    <div style="margin-top: 10px; font-size: 14px;">
      ğŸ’¡ ì…ë ¥ ì˜ˆì‹œ: $2^3 \times 5$ ì…ë ¥ ì‹œ <span class="key-tag">2</span> <span class="key-tag">^</span> <span class="key-tag">3</span> <span class="key-tag">*</span> <span class="key-tag">5</span> ìˆœì„œë¡œ ëˆ„ë¥´ì„¸ìš”.
    </div>
  </div>
</div>

<script>
// ë³€ìˆ˜ ì„ ì–¸
let targetNum = 0;
let stage = 1;
let wincount = 0;
let losecount = 0;
var timeout;

// ì´ˆê¸°í™” ë° ë¬¸ì œ ìƒì„±
function setStage(n) {
  stage = n;
  generateProblem();
}

function generateProblem() {
  clearInput();
  
  // ë‚œì´ë„ë³„ ì†Œìˆ˜ ë° ê°œìˆ˜ ì„¤ì •
  let primes = [2, 3, 5, 7];
  let minFactors, maxFactors;
  
  if (stage === 1) { 
    minFactors = 2; maxFactors = 3; 
  } else if (stage === 2) { 
    minFactors = 3; maxFactors = 4; 
  } else { 
    minFactors = 4; maxFactors = 5; 
    primes.push(11, 13); 
  }

  let numFactors = Math.floor(Math.random() * (maxFactors - minFactors + 1)) + minFactors;
  let result = 1;
  
  for(let i=0; i<numFactors; i++) {
    result *= primes[Math.floor(Math.random() * primes.length)];
  }
  
  targetNum = result;
  document.getElementById('problem').innerText = targetNum;
}

// ê²°ê³¼ ë¦¬ì…‹ í•¨ìˆ˜
function resultreset() {
    const r1 = document.getElementById("result1");
    r1.textContent = "ì •ë‹µì—¬ë¶€";
    r1.style.backgroundColor = "white";
    r1.style.color = "black";
}

// ì…ë ¥ ê´€ë ¨ í•¨ìˆ˜
function addChar(char) {
  const display = document.getElementById('inputDisplay');
  display.value += char;
}

function backspace() {
  const display = document.getElementById('inputDisplay');
  display.value = display.value.slice(0, -1);
}

function clearInput() {
  const display = document.getElementById('inputDisplay');
  display.value = "";
}

// ì •ë‹µ í™•ì¸ í•¨ìˆ˜ (ìˆœì„œ ë° ê±°ë“­ì œê³± ì²´í¬)
function checkAnswer() {
  let input = document.getElementById('inputDisplay').value;
  if (!input) return; 

  input = input.replace(/x/g, '*').replace(/X/g, '*');
  
  let parts = input.split('*');
  let userVal = 1;
  let isValidSyntax = true;
  let bases = [];

  try {
    for (let part of parts) {
      if (!part.trim()) continue;
      
      let base, exp;
      if (part.includes('^')) {
        let baseExp = part.split('^');
        base = parseInt(baseExp[0]);
        exp = parseInt(baseExp[1]);
      } else {
        base = parseInt(part);
        exp = 1; 
      }

      if (isNaN(base) || isNaN(exp)) throw new Error("Invalid");
      
      userVal *= Math.pow(base, exp);
      bases.push(base); 
    }
  } catch (e) {
    userVal = 0;
    isValidSyntax = false;
  }

  const r1 = document.getElementById("result1");
  const r2 = document.getElementById("result2");
  const r3 = document.getElementById("result3");

  // 1. ê³„ì‚°ê°’ ê²€ì¦
  if (!isValidSyntax || userVal !== targetNum || targetNum === 0) {
    losecount++;
    r1.textContent = "í‹€ë ¸ìŠµë‹ˆë‹¤.";
    r1.style.backgroundColor = "red";
    r1.style.color = "white";
    r3.textContent = losecount + "ë²ˆ í‹€ë ¸ìŠµë‹ˆë‹¤.";
    timeout = setTimeout(resultreset, 1000);
    return;
  }

  // 2. ìˆœì„œ ë° ê±°ë“­ì œê³± ì‚¬ìš© ì—¬ë¶€ ê²€ì¦
  let isSorted = true;
  let isCanonical = true; // ê±°ë“­ì œê³± ì‚¬ìš© ì—¬ë¶€

  for (let i = 0; i < bases.length - 1; i++) {
    // ì•ì˜ ë°‘ì´ ë’¤ì˜ ë°‘ë³´ë‹¤ í¬ë©´ -> ìˆœì„œ í‹€ë¦¼ (ì˜ˆ: 3 * 2)
    if (bases[i] > bases[i+1]) { 
      isSorted = false;
      break;
    }
    // ì•ì˜ ë°‘ê³¼ ë’¤ì˜ ë°‘ì´ ê°™ìœ¼ë©´ -> ê±°ë“­ì œê³± ì•ˆ ì”€ (ì˜ˆ: 2 * 2)
    if (bases[i] === bases[i+1]) {
      isCanonical = false;
      break;
    }
  }

  if (!isSorted) {
    losecount++; 
    r1.textContent = "ìˆœì„œê°€ í‹€ë ¸ìŠµë‹ˆë‹¤."; 
    r1.style.backgroundColor = "orange"; 
    r1.style.color = "white";
    r3.textContent = losecount + "ë²ˆ í‹€ë ¸ìŠµë‹ˆë‹¤.";
    timeout = setTimeout(resultreset, 1500);
    return;
  }

  if (!isCanonical) {
    losecount++; 
    r1.textContent = "ê±°ë“­ì œê³±ì„ ì‚¬ìš©í•˜ì„¸ìš”."; 
    r1.style.backgroundColor = "orange"; 
    r1.style.color = "white";
    r3.textContent = losecount + "ë²ˆ í‹€ë ¸ìŠµë‹ˆë‹¤.";
    timeout = setTimeout(resultreset, 1500);
    return;
  }

  // 3. ëª¨ë“  ì¡°ê±´ í†µê³¼
  wincount++;
  r1.textContent = "ì •ë‹µì…ë‹ˆë‹¤.";
  r1.style.backgroundColor = "green";
  r1.style.color = "white";
  r2.textContent = wincount + "ë²ˆ ì •ë‹µì…ë‹ˆë‹¤.";
  timeout = setTimeout(resultreset, 1000);
  setTimeout(generateProblem, 1000);
}

// í‚¤ë³´ë“œ ì…ë ¥ ì²˜ë¦¬ ë° í¬ì»¤ìŠ¤ ê´€ë¦¬
document.addEventListener('keydown', function(event) {
  const key = event.key;
  
  if (key >= '0' && key <= '9') {
    addChar(key);
  } 
  else if (key === '*' || key.toLowerCase() === 'x') {
    addChar('*');
  } 
  else if (key === '^') {
    addChar('^');
  } 
  else if (key === 'Backspace') {
    backspace();
  } 
  else if (key === 'Enter') {
    event.preventDefault(); 
    checkAnswer();
  } 
  else if (key === 'Escape' || key.toLowerCase() === 'c') {
    clearInput();
  }
});

// ë²„íŠ¼ í¬ì»¤ìŠ¤ í•´ì œ (í‚¤íŒ¨ë“œ ì—°ì† ì…ë ¥ ë°©ì§€)
document.addEventListener('DOMContentLoaded', () => {
    const buttons = document.querySelectorAll('button');
    buttons.forEach(btn => {
        btn.addEventListener('click', function() {
            this.blur(); 
        });
    });
});

window.onload = () => generateProblem();
</script>
</body>
</html>