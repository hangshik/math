<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>유리수의 덧셈과 뺄셈</title>
    
    <!-- MathJax 스크립트 -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>

    <style>
      body {
          text-size-adjust: 50px;
          font-family: sans-serif;
      }

      div {
          display: flex;
          justify-content: center;
          align-items: center;    
      }

      .container {
          display: grid;
          gap: 10px;
      }

      .button {
          width: 60px;
          height: 60px;
          font-size: 25px;
          line-height: 60px;
          margin: 2px 0px;
          border-radius: 10px;
          border: none;
          background-color: #DDDDDD;
          cursor: pointer;
      }

      .button:hover {
          background-color: #bbb;
      }

      #txt {
          font-size: 26px;
          width: 80px;
          height: 40px;
          text-align: center;
          margin-left: 10px;
      }

      .problem-container {
        display: flex; 
        align-items: center; 
        justify-content: center; 
        text-align: center;
        margin-bottom: 10px;
        min-height: 100px; /* 수식 높이 확보 */
      }
      
      #problem {
        font-size: 24px; /* 수식 크기 */
        margin-right: 15px;
      }
    </style>
  </head>
  <body>
    <center>
      <h1>유리수의 덧셈과 뺄셈</h1>

      <div class="problem-container">
        <div id="problem">문제 로딩중...</div>
        <font size="5">=</font>
        <input type="text" id="txt" value="" readonly>
      </div>
      
      <button class="button" onclick="appendNumber(1)">1</button>
      <button class="button" onclick="appendNumber(2)">2</button>
      <button class="button" onclick="appendNumber(3)">3</button>
      <button class="button" onclick="appendNumber(4)">4</button>
      <button class="button" onclick="appendNumber(5)">5</button><br>
      <button class="button" onclick="appendNumber(6)">6</button>
      <button class="button" onclick="appendNumber(7)">7</button>
      <button class="button" onclick="appendNumber(8)">8</button>
      <button class="button" onclick="appendNumber(9)">9</button>
      <button class="button" onclick="appendNumber(0)">0</button><br>
      
      <button class="button" onclick="appendNumber('-')">-</button>
      <button class="button" onclick="appendNumber('/')">/</button>
      <button class="button" onclick="clearInput()">C</button>
      <button class="button" onclick="backspace()">←</button>
      <button class="button" onclick="main()" style="background-color: #3399FF; color: white;">확인</button>
    
    <hr/>
    <div id="result1" style="font-size:30px">정답여부</div>
    <div id="result2" style="font-size:30px">0번 정답입니다.</div>
    <div id="result3" style="font-size:30px">0번 틀렸습니다.</div>
    <br>
    <font size="4px" color="red"><b>[주의: 반드시 기약분수로 입력하세요]</b></font><br>
    <font size="3px">(예: -2/4는 오답, -1/2이 정답)</font>
    </center>

    <script>
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
    });

      let wincount = 0;
      let losecount = 0;
      let ansNum = 0; 
      let ansDen = 1; 
      var timeout;

      function gcd(a, b) {
          return b === 0 ? a : gcd(b, a % b);
      }

      function generateFraction() {
          let den, num;
          while(true) {
              den = Math.floor(Math.random() * 5) + 2; 
              num = Math.floor(Math.random() * 18 - 9); 
              if (num === 0) continue;

              let common = gcd(Math.abs(num), den);
              num = num / common;
              den = den / common;

              if (den === 1) continue; 
              return { n: num, d: den };
          }
      }

      function start() {
          let f1 = generateFraction();
          let f2 = generateFraction();
          
          let op = Math.floor(Math.random() * 2); // 0: +, 1: -

          // 정답 계산
          let resNum, resDen;
          if(op == 0) {
              resNum = (f1.n * f2.d) + (f2.n * f1.d);
              resDen = f1.d * f2.d;
          } else {
              resNum = (f1.n * f2.d) - (f2.n * f1.d);
              resDen = f1.d * f2.d;
          }

          // start() 함수에서 정답(ansNum, ansDen)을 미리 '기약분수' 형태로 저장해 둡니다.
          let common = gcd(Math.abs(resNum), resDen);
          ansNum = resNum / common;
          ansDen = resDen / common;

          // --- MathJax 표현 로직 ---
          function getFracLatex(n, d) {
            return `\\frac{${Math.abs(n)}}{${d}}`;
          }

          let term1 = "";
          if (f1.n > 0) {
            term1 = getFracLatex(f1.n, f1.d);
          } else {
            term1 = "-" + getFracLatex(f1.n, f1.d);
          }

          let opStr = (op == 0) ? "+" : "-";

          let term2 = "";
          if (f2.n > 0) {
            term2 = getFracLatex(f2.n, f2.d);
          } else {
            term2 = `\\left( -${getFracLatex(f2.n, f2.d)} \\right)`;
          }

          let latexExpression = `$$ ${term1} ${opStr} ${term2} $$`;

          const problemDiv = document.getElementById("problem");
          problemDiv.innerHTML = latexExpression;
          
          if (window.MathJax) {
            MathJax.typesetPromise([problemDiv]).catch((err) => console.log(err));
          }
      }

      function resultreset() {
          document.getElementById("result1").textContent = "정답여부";
          document.getElementById("result1").style.backgroundColor = "white";
          document.getElementById("result1").style.color = "black";
      }

      function appendNumber(num) {
          const input = document.getElementById("txt");
          input.value += num;
      }

      function backspace() {
          const input = document.getElementById("txt");
          input.value = input.value.slice(0, -1); 
      }

      function clearInput() {
          const input = document.getElementById("txt");
          input.value = ""; 
      }

      function main() {
          const input = document.getElementById("txt");
          let val = input.value;
          
          if(val != "") {
              let parts = val.split("/");
              let userNum = 0;
              let userDen = 1;

              if (parts.length === 2) {
                  userNum = parseInt(parts[0]);
                  userDen = parseInt(parts[1]);
              } else if (parts.length === 1) {
                  userNum = parseInt(parts[0]);
                  userDen = 1;
              } else {
                  userNum = NaN;
              }

              let isCorrect = false;
              if (!isNaN(userNum) && !isNaN(userDen) && userDen !== 0) {
                  // 부호 표준화: 분모가 음수면 분자로 부호 이동 (예: 1/-2 -> -1/2)
                  if (userDen < 0) {
                      userNum = -userNum;
                      userDen = -userDen;
                  }

                  // [수정된 로직] 기약분수 검사
                  // ansNum, ansDen은 이미 기약분수 상태이므로,
                  // 사용자가 입력한 분자/분모와 '정확히' 일치해야만 정답으로 처리합니다.
                  if (userNum === ansNum && userDen === ansDen) {
                      isCorrect = true;
                  }
              }

              if(isCorrect) {
                  wincount++;
                  document.getElementById("result1").textContent = "정답입니다.";
                  document.getElementById("result1").style.backgroundColor = "green";
                  document.getElementById("result1").style.color = "white";
                  timeout = setTimeout("resultreset()", 1000);
                  document.getElementById("result2").textContent = wincount + "번 정답입니다.";
                  start();
              } else {
                  losecount++;
                  document.getElementById("result1").textContent = "틀렸습니다.";
                  document.getElementById("result1").style.backgroundColor = "red";
                  document.getElementById("result1").style.color = "white";
                  timeout = setTimeout("resultreset()", 1000);
                  document.getElementById("result3").textContent = losecount + "번 틀렸습니다.";
              }
          }
          input.value = "";
      }

      onload = () => {
          start();
      }

      document.addEventListener('keydown', function(event) {
          const key = event.key;
          if (key >= '0' && key <= '9') {
              appendNumber(key);
          } else if (key === '-') {
              appendNumber('-');
          } else if (key === '/') { 
              appendNumber('/');
          } else if (key === 'Backspace') {
              backspace(); 
          } else if (key === 'Escape') {
              clearInput(); 
          } else if (key === 'Enter') {
              main(); 
          }
      });
    </script>
  </body>
</html>