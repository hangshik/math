<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì—°ë¦½ë°©ì •ì‹ êµì  ì‚¬ê²©</title>
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #f9f9f9; color: #333; padding: 20px; user-select: none; }
    
    .game-container { 
      background: white; max-width: 600px; margin: 0 auto; padding: 20px; 
      border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
    }

    h2 { color: #1976D2; margin-bottom: 10px; }

    .equation-box { 
      background: #f1f8e9; padding: 15px; border-radius: 10px; display: inline-block; 
      margin-bottom: 15px; font-size: 22px; border: 2px solid #c5e1a5; color: #33691e;
      min-width: 200px;
    }

    canvas { 
      background: #fff; border: 2px solid #90caf9; border-radius: 10px; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
    }
    
    .input-section { margin: 15px 0; display: flex; justify-content: center; align-items: center; gap: 10px; }
    
    .input-box {
      width: 70px; height: 40px; font-size: 24px; text-align: center;
      border: 2px solid #ccc; border-radius: 5px;
      cursor: pointer; background: #fff; line-height: 40px;
    }
    .selected { background-color: #3399FF; color: white; border-color: #0056b3; }

    .button {
      width: 60px; height: 60px; font-size: 25px; margin: 3px;
      border-radius: 10px; border: none; background-color: #e0e0e0; cursor: pointer; color: #333;
      transition: background 0.1s;
    }
    .button:hover { background-color: #bdbdbd; }
    
    .btn-wide {
      width: 130px; 
      background-color: #3399FF; color: white;
    }
    .btn-wide:hover { background-color: #1976D2; }

    .btn-new { 
      font-size: 20px; padding: 10px 20px; border: none; border-radius: 10px; 
      cursor: pointer; margin-top: 15px; color: white; background-color: #FF9800; width: 320px; 
    }
    .btn-new:disabled { background-color: #ccc; cursor: not-allowed; }

    #result1 { min-height: 45px; margin-top: 20px; padding: 5px; border-radius: 5px; font-weight: bold;}
    .stats { font-size: 20px; margin-top: 5px; color: #555; }
  </style>
</head>
<body>

<div class="game-container">
  <h2>ğŸ¯ ì—°ë¦½ë°©ì •ì‹ êµì  ì‚¬ê²©</h2>
  <p>í‚¤íŒ¨ë“œë¡œ êµì  $(x, y)$ë¥¼ ì…ë ¥í•˜ê³  <b>í™•ì¸</b>ì„ ëˆ„ë¥´ì„¸ìš”.<br>ì •í™•íˆ ì¡°ì¤€í•´ì•¼ í•©ë‹ˆë‹¤!</p>

  <div id="equationDisplay" class="equation-box">
    ë¬¸ì œ ìƒì„± ì¤‘...
  </div>
  <br>

  <canvas id="canvas" width="400" height="400"></canvas>

  <div class="input-section">
    <span style="font-size: 24px;">(</span>
    <input type="text" id="inputX" class="input-box selected" readonly onclick="selectInput('x')" placeholder="x">
    <span style="font-size: 24px;">,</span>
    <input type="text" id="inputY" class="input-box" readonly onclick="selectInput('y')" placeholder="y">
    <span style="font-size: 24px;">)</span>
  </div>

  <div>
    <button class="button" onclick="appendNumber(1)">1</button>
    <button class="button" onclick="appendNumber(2)">2</button>
    <button class="button" onclick="appendNumber(3)">3</button>
    <button class="button" onclick="appendNumber(4)">4</button>
    <button class="button" onclick="appendNumber(5)">5</button><br>
    
    <button class="button" onclick="appendNumber(6)">6</button>
    <button class="button" onclick="appendNumber(7)">7</button>
    <button class="button" onclick="appendNumber(8)">8</button>
    <button class="button" onclick="appendNumber(9)">9</button>
    <button class="button" onclick="appendNumber(0)">0</button><br>
    
    <button class="button" onclick="appendNumber('-')">-</button>
    <button class="button" onclick="clearInput()">C</button>
    <button class="button" onclick="backspace()">â†</button>
    <button class="button btn-wide" onclick="handleConfirm()">í™•ì¸</button>
    
    <br>
    <button id="nextBtn" class="btn-new" onclick="initGame()" disabled>ë‹¤ìŒ ë¬¸ì œ (Space)</button>
  </div>

  <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
  
  <div id="result1" style="font-size:30px;">ê²°ê³¼ ëŒ€ê¸° ì¤‘</div>
  <div id="result2" class="stats">0ë²ˆ ì •ë‹µì…ë‹ˆë‹¤.</div>
  <div id="result3" class="stats">0ë²ˆ í‹€ë ¸ìŠµë‹ˆë‹¤.</div>
</div>

<script>
const cvs = document.getElementById('canvas');
const ctx = cvs.getContext('2d');
const unit = 20; 
const cx = cvs.width / 2;
const cy = cvs.height / 2;

let sol = {x:0, y:0};
let line1 = {m:0, k:0};
let line2 = {m:0, k:0};
let selectedInputId = 'inputX'; 

let winCount = 0;
let loseCount = 0;

function initGame() {
  sol.x = Math.floor(Math.random() * 17) - 8;
  sol.y = Math.floor(Math.random() * 17) - 8;

  let m1 = Math.floor(Math.random() * 5) - 2; 
  let m2 = m1;
  while(m2 === m1) m2 = Math.floor(Math.random() * 5) - 2;

  line1.m = m1; line1.k = sol.y - m1 * sol.x;
  line2.m = m2; line2.k = sol.y - m2 * sol.x;

  updateEquationDisplay(line1, line2);

  document.getElementById('inputX').value = "";
  document.getElementById('inputY').value = "";
  
  selectInput('x'); 
  resetResultMsg();
  document.getElementById('nextBtn').disabled = true;
  
  // ì •ë‹µ ì—¬ë¶€ ì´ˆê¸°í™” ìƒíƒœë¡œ ê·¸ë¦¬ê¸°
  drawGraph(null, false);
}

function updateEquationDisplay(l1, l2) {
  const eq1Str = formatEq(l1.m, l1.k);
  const eq2Str = formatEq(l2.m, l2.k);
  
  const latex = `
    \\[
    \\begin{cases}
      y = ${eq1Str} \\\\
      y = ${eq2Str}
    \\end{cases}
    \\]
  `;
  
  const display = document.getElementById('equationDisplay');
  display.innerHTML = latex;
  
  if (window.MathJax) {
    MathJax.typesetPromise([display]).catch((err) => console.log(err));
  }
}

function formatEq(m, k) {
  let s = "";
  if(m === 1) s += "x";
  else if(m === -1) s += "-x";
  else if(m !== 0) s += m + "x";
  
  if(k > 0) s += (m!==0 ? "+" : "") + k;
  else if(k < 0) s += k;
  else if(k === 0 && m === 0) s += "0";
  
  return s;
}

// ì…ë ¥ì°½ ì„ íƒ ë¡œì§ (ìˆ˜ì •: ì„ íƒ ì‹œ ê°’ ì´ˆê¸°í™”)
function selectInput(type) {
  document.getElementById('inputX').classList.remove('selected');
  document.getElementById('inputY').classList.remove('selected');

  if (type === 'x') selectedInputId = 'inputX';
  else selectedInputId = 'inputY';

  const target = document.getElementById(selectedInputId);
  target.classList.add('selected');
  
  // [ìˆ˜ì • ì‚¬í•­ 4] ì„ íƒ ì‹œ ê¸°ì¡´ ê°’ì´ ìˆìœ¼ë©´ ì§€ì›Œì¤Œ
  if (target.value !== "") {
    target.value = "";
  }
  
  if (document.getElementById('result1').textContent !== "ê²°ê³¼ ëŒ€ê¸° ì¤‘") {
      resetResultMsg();
  }
}

function resetResultMsg() {
  const res = document.getElementById('result1');
  res.textContent = "ê²°ê³¼ ëŒ€ê¸° ì¤‘";
  res.style.backgroundColor = "transparent";
  res.style.color = "#ccc";
}

function appendNumber(num) {
  const input = document.getElementById(selectedInputId);
  if (num === '-' && input.value.includes('-')) return;
  input.value += num;
  resetResultMsg();
}

function backspace() {
  const input = document.getElementById(selectedInputId);
  input.value = input.value.slice(0, -1);
  resetResultMsg();
}

function clearInput() {
  const input = document.getElementById(selectedInputId);
  input.value = "";
  resetResultMsg();
}

// í™•ì¸ ë²„íŠ¼ (ë°œì‚¬)
function handleConfirm() {
  const valX = document.getElementById('inputX').value.trim();
  const valY = document.getElementById('inputY').value.trim();

  if (valX === "" || valY === "" || valX === "-" || valY === "-") return;

  const userX = parseInt(valX);
  const userY = parseInt(valY);

  const isCorrect = (userX === sol.x && userY === sol.y);

  // ê·¸ë˜í”„ì— ë°œì‚¬ í‘œì‹œ (ì •ë‹µ ì—¬ë¶€ ì „ë‹¬)
  drawGraph({x: userX, y: userY}, isCorrect);

  const res = document.getElementById('result1');
  if (isCorrect) {
    res.textContent = "ëª…ì¤‘ì…ë‹ˆë‹¤! ì •ë‹µ! ğŸ¯";
    res.style.backgroundColor = "#4caf50"; 
    res.style.color = "white";
    
    winCount++;
    document.getElementById('result2').textContent = `${winCount}ë²ˆ ì •ë‹µì…ë‹ˆë‹¤.`;
    document.getElementById('nextBtn').disabled = false;
  } else {
    // [ìˆ˜ì • ì‚¬í•­ 1] ì˜¤ë‹µ ì‹œ ì •ë‹µ ì¢Œí‘œ ë¯¸ë…¸ì¶œ
    res.textContent = "ë¹—ë‚˜ê°”ìŠµë‹ˆë‹¤.";
    res.style.backgroundColor = "#f44336";
    res.style.color = "white";
    
    loseCount++;
    document.getElementById('result3').textContent = `${loseCount}ë²ˆ í‹€ë ¸ìŠµë‹ˆë‹¤.`;
  }
}

// ê·¸ë˜í”„ ê·¸ë¦¬ê¸° (ìˆ˜ì •: í™”ì‚´í‘œ, ë¼ë²¨, ì •ë‹µ ì€í)
function drawGraph(userShot = null, showAnswer = false) {
  const w = cvs.width;
  const h = cvs.height;

  ctx.clearRect(0, 0, w, h);
  
  // ê·¸ë¦¬ë“œ
  ctx.strokeStyle = "#e1f5fe";
  ctx.lineWidth = 1;
  ctx.beginPath();
  for(let i=0; i<=w; i+=unit) { ctx.moveTo(i,0); ctx.lineTo(i,h); }
  for(let i=0; i<=h; i+=unit) { ctx.moveTo(0,i); ctx.lineTo(w,i); }
  ctx.stroke();

  // X, Yì¶• ë° í™”ì‚´í‘œ
  ctx.strokeStyle = "#546e7a";
  ctx.fillStyle = "#546e7a";
  ctx.lineWidth = 2;
  
  ctx.beginPath();
  // Xì¶•
  ctx.moveTo(0, cy); ctx.lineTo(w, cy);
  // í™”ì‚´í‘œ (ì˜¤ë¥¸ìª½)
  ctx.moveTo(w-10, cy-5); ctx.lineTo(w, cy); ctx.lineTo(w-10, cy+5);
  
  // Yì¶•
  ctx.moveTo(cx, h); ctx.lineTo(cx, 0);
  // í™”ì‚´í‘œ (ìœ„ìª½)
  ctx.moveTo(cx-5, 10); ctx.lineTo(cx, 0); ctx.lineTo(cx+5, 10);
  ctx.stroke();

  // [ìˆ˜ì • ì‚¬í•­ 3] ì¶• ë¼ë²¨ (x, y, O)
  ctx.font = "bold 16px Arial";
  ctx.fillText("x", w - 20, cy + 20);
  ctx.fillText("y", cx + 10, 20);
  ctx.fillText("O", cx - 20, cy + 20); // ì›ì 

  // ì§ì„  ê·¸ë¦¬ê¸°
  drawLine(line1, '#2196F3'); // Blue
  drawLine(line2, '#FF9800'); // Orange

  // ì‚¬ìš©ì ì‚¬ê²© í‘œì‹œ
  if(userShot) {
    const px = cx + userShot.x * unit;
    const py = cy - userShot.y * unit;
    
    // ìœ ì € ì  (ë¹¨ê°•)
    ctx.fillStyle = "#f44336";
    ctx.beginPath();
    ctx.arc(px, py, 6, 0, Math.PI*2);
    ctx.fill();
    
    // [ìˆ˜ì • ì‚¬í•­ 1] ì •ë‹µ ìœ„ì¹˜(ë…¹ìƒ‰ ë§)ëŠ” ì •ë‹µì„ ë§ì·„ì„ ë•Œë§Œ í‘œì‹œ
    if (showAnswer) {
      const tx = cx + sol.x * unit;
      const ty = cy - sol.y * unit;
      ctx.strokeStyle = "#4caf50";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.arc(tx, ty, 10, 0, Math.PI*2);
      ctx.stroke();
    }
  }
}

function drawLine(line, color) {
  ctx.strokeStyle = color;
  ctx.lineWidth = 3;
  ctx.beginPath();
  const x1 = -20, y1 = line.m * x1 + line.k;
  const x2 = 20, y2 = line.m * x2 + line.k;
  
  ctx.moveTo(cx + x1*unit, cy - y1*unit);
  ctx.lineTo(cx + x2*unit, cy - y2*unit);
  ctx.stroke();
}

// [ìˆ˜ì • ì‚¬í•­ 2] ìº”ë²„ìŠ¤ í´ë¦­ ì…ë ¥ ê¸°ëŠ¥ ì œê±°ë¨ (ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì‚­ì œ)

// í‚¤ë³´ë“œ ì´ë²¤íŠ¸ í•¸ë“¤ë§
document.addEventListener('keydown', e => {
  if ((e.key >= '0' && e.key <= '9') || e.key === '-') {
    appendNumber(e.key);
  }
  else if (e.key === 'Backspace') backspace();
  else if (e.key === 'Escape') clearInput();
  else if (e.key === 'Enter') {
    e.preventDefault();
    handleConfirm();
  }
  else if (e.code === 'Space') {
    if (!document.getElementById('nextBtn').disabled) {
      e.preventDefault();
      initGame();
    }
  }
  else if (e.key === 'Tab') {
    e.preventDefault();
    if (selectedInputId === 'inputX') selectInput('y');
    else selectInput('x');
  }
});

window.onload = initGame;
</script>
</body>
</html>